<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Running a simulation with SHyFT &#8212; Shyft 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="top" title="Shyft 0.1 documentation" href="../../index.html" />
    <link rel="up" title="Notebooks" href="../../notebook.html" />
    <link rel="next" title="Running a calibration with SHyFT" href="calibrate_nea_nidelva.html" />
    <link rel="prev" title="Notebooks" href="../../notebook.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="calibrate_nea_nidelva.html" title="Running a calibration with SHyFT"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../../notebook.html" title="Notebooks"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Shyft 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../getting_started.html" >Getting Started</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../notebook.html" accesskey="U">Notebooks</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class^=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: #D84315;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>
<div class="section" id="Running-a-simulation-with-SHyFT">
<h1>Running a simulation with SHyFT<a class="headerlink" href="#Running-a-simulation-with-SHyFT" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>Shyft provides a toolbox for running hydrologic simulations. As it was
designed to work in an operational environment, we&#8217;ve provided several
different mechanisms for running the models. The main concept to be
aware of is that while we demonstrate and build on the use of a
&#8216;configuration&#8217;, nearly all simulation functionality is also accessible
with pure python. The use of configurations is intended to be a
mechanism of archiving and storing (potentially to a database) the
specifics of the simulation.</p>
<p>Below we start with a high level description using a configuration
object, and in Part II of the simulation notebooks we describe the
approach using the lower level APIs. It is recommended, if you intend to
use Shyft for any kind of hydrologic exploration, to become familiar
with the API functionality.</p>
<div class="section" id="This-notebook-is-guiding-through-the-simulation-process-of-a-catchment.-The-following-steps-are-described:">
<h3>This notebook is guiding through the simulation process of a catchment. The following steps are described:<a class="headerlink" href="#This-notebook-is-guiding-through-the-simulation-process-of-a-catchment.-The-following-steps-are-described:" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><strong>Loading required python modules and setting path to SHyFT
installation</strong></li>
<li><strong>Configuration of a SHyFT simulation</strong></li>
<li><strong>Running a SHyFT simulation</strong></li>
<li><strong>Post-processing:</strong> Fetching simulation results from the
simulator-object.</li>
</ol>
</div>
</div>
<div class="section" id="1.-Loading-required-python-modules-and-setting-path-to-SHyFT-installation">
<h2>1. Loading required python modules and setting path to SHyFT installation<a class="headerlink" href="#1.-Loading-required-python-modules-and-setting-path-to-SHyFT-installation" title="Permalink to this headline">¶</a></h2>
<p>Shyft requires a number of different modules to be loaded as part of the
package. Below, we describe the required steps for loading the modules,
and note that some steps are only required for the use of the jupyter
notebook.</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Pure python modules and jupyter notebook functionality</span>
<span class="c1"># first you should import the third-party python modules which you&#39;ll use later on</span>
<span class="c1"># the first line enables that figures are shown inline, directly in the notebook</span>
<span class="o">%</span><span class="k">pylab</span> inline
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="kn">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
Populating the interactive namespace from numpy and matplotlib
</pre></div></div>
</div>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># now we create the shyft specific environment</span>
<span class="c1"># set the path for your shyft build</span>
<span class="c1"># this should point to the directory that is created</span>
<span class="c1"># when you clone shyft, assuming you have built shyft</span>
<span class="c1"># there and not installed it to your system python</span>
<span class="c1"># if you followed the recommendations in the README, then</span>
<span class="c1"># you will have cloned three git repos in a parallel structure</span>
<span class="c1"># and can point to the shyft repository:</span>
<span class="n">shyft_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;../../../shyft&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">shyft_path</span><span class="p">)</span>

<span class="c1"># Note: you could achieve the same by setting a PYTHONPATH</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># once the shyft_path is set correctly, you should be able to import shyft modules</span>
<span class="kn">import</span> <span class="nn">shyft</span>
<span class="kn">from</span> <span class="nn">shyft</span> <span class="kn">import</span> <span class="n">shyftdata_dir</span>

<span class="c1"># if you have problems here, it may be related to having your LD_LIBRARY_PATH</span>
<span class="c1"># pointing to the appropriate libboost_python libraries (.so files)</span>
<span class="kn">from</span> <span class="nn">shyft</span> <span class="kn">import</span> <span class="n">api</span>
<span class="kn">from</span> <span class="nn">shyft.repository.default_state_repository</span> <span class="kn">import</span> <span class="n">DefaultStateRepository</span>
<span class="kn">from</span> <span class="nn">shyft.orchestration.configuration.yaml_configs</span> <span class="kn">import</span> <span class="n">YAMLSimConfig</span>
<span class="kn">from</span> <span class="nn">shyft.orchestration.simulators.config_simulator</span> <span class="kn">import</span> <span class="n">ConfigSimulator</span>

</pre></div>
</div>
</div>
<div class="section" id="A-note-on-Help-with-Shyft">
<h3>A note on Help with Shyft<a class="headerlink" href="#A-note-on-Help-with-Shyft" title="Permalink to this headline">¶</a></h3>
<p>Shyft is designed to make use of standard help functionality in Python.
You are able to access help functionality using tab completion or
<code class="docutils literal"><span class="pre">help()</span></code>. We have not yet been able to make use of the &#8221;?&#8221; or &#8221;??&#8221;
standards in IPython, so please use <code class="docutils literal"><span class="pre">help</span></code>. In the following cell,
uncomment the lines to explore the two options for getting help.</p>
<p>Also, note that in some cases, the doc strings are generated directly
from the C++ underlying code, so you will see full C++ call signatures .
If you use <code class="docutils literal"><span class="pre">help(shyft_object)</span></code> and get something that is looks a bit
overwhelming or unfamiliar, just realize that the methods are generally
showing how to call a method and what it returns. See for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">set_state_collection</span><span class="p">)</span>
</pre></div>
</div>
<p>Returns:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Help</span> <span class="n">on</span> <span class="n">method</span> <span class="n">set_state_collection</span><span class="p">:</span>

<span class="n">set_state_collection</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="n">method</span> <span class="n">of</span>  <span class="n">shyft</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">pt_gs_k</span><span class="o">.</span><span class="n">_pt_gs_k</span><span class="o">.</span><span class="n">PTGSKModel</span> <span class="n">instance</span>
<span class="n">set_state_collection</span><span class="p">(</span> <span class="p">(</span><span class="n">PTGSKModel</span><span class="p">)</span><span class="n">arg1</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="n">catchment_id</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)</span><span class="n">on_or_off</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="p">:</span>
    <span class="n">enable</span> <span class="n">state</span> <span class="n">collection</span> <span class="k">for</span> <span class="n">specified</span> <span class="ow">or</span> <span class="nb">all</span>
    <span class="n">cells</span> <span class="n">note</span> <span class="n">that</span> <span class="n">this</span> <span class="n">only</span> <span class="n">works</span> <span class="k">if</span> <span class="n">the</span> <span class="n">underlying</span>
    <span class="n">cell</span> <span class="ow">is</span> <span class="n">configured</span> <span class="n">to</span> <span class="n">do</span> <span class="n">state</span> <span class="n">collection</span><span class="o">.</span> <span class="n">This</span>
    <span class="ow">is</span> <span class="n">typically</span> <span class="ow">not</span> <span class="n">the</span>  <span class="n">case</span> <span class="k">for</span> <span class="n">cell</span><span class="o">-</span><span class="n">types</span> <span class="n">that</span>
    <span class="n">are</span> <span class="n">used</span> <span class="n">during</span> <span class="n">calibration</span><span class="o">/</span><span class="n">optimization</span>
</pre></div>
</div>
<p>What this means is that <em>method</em> <code class="docutils literal"><span class="pre">set_state_collection</span></code> has a call
signature as:
<code class="docutils literal"><span class="pre">set_state_collection(</span> <span class="pre">(PTGSKModel)arg1,</span> <span class="pre">(int)catchment_id,</span> <span class="pre">(bool)on_or_off)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code>
This means, the method should be called with the first positional
argument as the model, or <code class="docutils literal"><span class="pre">self</span></code>, so it is already there when you call
it from <code class="docutils literal"><span class="pre">region_model</span></code>. The second positional argument should be an
integer referring to the catchment_id (more on this later), and the
third is a boolean indicating True or False. So to make use of this
<em>method</em> you would call it like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">set_state_collection</span><span class="p">(</span><span class="mi">1228</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>And state collection would be turned <em>off</em> for catchment with
catchment_id 1228.</p>
<p>Okay, so now you are ready to explore Shyft internals further! Remember,
<em>use ``help()``</em>!!</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># now you can access the api of shyft with tab completion</span>
<span class="c1"># and help, try this:</span>

<span class="c1">#help(api.GeoPoint) # remove the hashtag and run the cell to print the documentation of the api.GeoPoint class</span>

<span class="c1"># remove the hashtag below, set the pointer behind the dot and use</span>
<span class="c1"># tab completion to see the available attributes of the shyft api</span>

<span class="c1">#api.</span>

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="2.-Configuration-of-a-SHyFT-simulation">
<h2>2. Configuration of a SHyFT simulation<a class="headerlink" href="#2.-Configuration-of-a-SHyFT-simulation" title="Permalink to this headline">¶</a></h2>
<p>The following shows how to set up a Shyft simulation using the
<code class="docutils literal"><span class="pre">yaml_configs.YAMLSimConfig</span></code> class. Note that this is a <strong>high level</strong>
approach, providing a working example for a simple simulation. More
advanced users will want to eventually make use of direct API calls, as
outlined in Part II.</p>
<p>At this point, you may want to have a look to the <a class="reference external" href="./nea-config/neanidelva_simulation.yaml">configuration
file</a> used in this example.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>---
neanidelva:
  region_config_file: neanidelva_region.yaml
  model_config_file: neanidelva_model_calibrated.yaml
  datasets_config_file: neanidelva_datasets.yaml
  interpolation_config_file: neanidelva_interpolation.yaml
  start_datetime: 2013-09-01T00:00:00
  run_time_step: 86400  # 1 hour time step
  number_of_steps: 365  # 1 year
  region_model_id: &#39;neanidelva-ptgsk&#39;
  #interpolation_id: 2   # this is optional (default 0)
  initial_state:
    repository:
      class: !!python/name:shyft.repository.generated_state_repository.GeneratedStateRepository
      params:
        model: !!python/name:shyft.api.pt_gs_k.PTGSKModel
    tags: []
...
</pre></div>
</div>
<p>The file is structured as follows:</p>
<p><code class="docutils literal"><span class="pre">neanidelva</span></code> is the name of the simulation. Your configuration file
may contain multiple &#8220;stanzas&#8221; or blocks of simulation configurations.
You&#8217;ll see below that we use the name to instantiate a configuration
object.</p>
<p><code class="docutils literal"><span class="pre">region_config_file</span></code> points to another yaml file that contains basic
information about the region of the simulation. You can <a class="reference external" href="./nea-config/neanidelva_region.yaml">explore that
file here</a></p>
<p><code class="docutils literal"><span class="pre">model_config_file</span></code> contains the model parameters. Note that when you
are calibrating the model, <a class="reference external" href="./nea-config/neanidelva_model_calibrated.yaml">this is the
file</a> that you would
put your optimized parameters into once you have completed a
calibrations.</p>
<p><code class="docutils literal"><span class="pre">datasets_config_file</span></code> contains details regarding the input datasets
and the <a class="reference external" href="../../repositories.rst">repositories</a> they are contained in.
You can see <a class="reference external" href="./nea-config/neanidelva_datasets.yaml">this file here</a></p>
<p><code class="docutils literal"><span class="pre">interpolation_config_file</span></code> provides details regarding how the
observational data in your catchment or region will be interpolated to
the domain of the simulation. If you are using a repository with
distributed data, the interpolation is still used. <a class="reference external" href="./nea-config/neanidelva_interpolation.yaml">See this
file</a> for more details.</p>
<p>The following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">start_datetime</span><span class="p">:</span> <span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">run_time_step</span><span class="p">:</span> <span class="mi">86400</span>  <span class="c1"># 1 hour time step</span>
<span class="n">number_of_steps</span><span class="p">:</span> <span class="mi">365</span>  <span class="c1"># 1 year</span>
<span class="n">region_model_id</span><span class="p">:</span> <span class="s1">&#39;neanidelva-ptgsk&#39;</span>
</pre></div>
</div>
<p>are considered self-explantory. Note that <code class="docutils literal"><span class="pre">region_model_id</span></code> is simply
a string name, but it should be <strong>unique</strong>. We will explain the details
regarding <code class="docutils literal"><span class="pre">initial_state</span></code> later on in this tutorial.</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># set up configuration using *.yaml configuration files</span>
<span class="c1"># here is the *.yaml file that configures the simulation:</span>
<span class="n">config_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;./nea-config/neanidelva_simulation.yaml&quot;</span><span class="p">)</span>

<span class="c1"># and here we pass it to the configurator, together with the name of the region</span>
<span class="c1"># stated in the simulation.yaml file (here: &quot;neanidelva&quot;) which we would like to run</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">YAMLSimConfig</span><span class="p">(</span><span class="n">config_file_path</span><span class="p">,</span> <span class="s2">&quot;neanidelva&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Once we have all the configuration in place (read in from the .yaml files)</span>
<span class="c1"># we can start to do the simulation. Here we use the ConfigSimulator class</span>
<span class="c1"># to initialize a simulator-object. Shyft has several ways to achieve this</span>
<span class="c1"># but the .yaml configs are the most straight forward</span>

<span class="n">simulator</span> <span class="o">=</span> <span class="n">ConfigSimulator</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
<span class="c1"># Now the simulator is ready to run!</span>
</pre></div>
</div>
</div>
<div class="section" id="The-simulator-and-the-region_model">
<h3>The simulator and the region_model<a class="headerlink" href="#The-simulator-and-the-region_model" title="Permalink to this headline">¶</a></h3>
<p>It is important to note that the simulator provides a wrapping of
underlying API functionality. It is designed to provide a quick and
simple interface for conducting runs based on a configuration saved in a
<code class="docutils literal"><span class="pre">.yaml</span></code> file, or otherwise. Core functionality is contained in the
<a class="reference internal" href="../../introduction.html"><span class="doc">region_model</span></a>. This is an import concept in
Shyft. To understand the framework, one should be familiar with this
class.</p>
<p>Before we begin the simulation, one should explore the <code class="docutils literal"><span class="pre">simulator</span></code>
object with tab completion. As an example, you can see here how to get
the number of cells in the region that was set up. This is used later
for extracting the data.</p>
<p>Most importantly, the simulator as an attribute called <code class="docutils literal"><span class="pre">region_model</span></code>.
Most of the underlying functionality of the <code class="docutils literal"><span class="pre">simulator</span></code> methods are
actually making calls to the <code class="docutils literal"><span class="pre">region_model</span></code> class. To conduct more
advanced simulations one would use this object directly.</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1">#simulator.  #try tab completion</span>
<span class="n">n_cells</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">n_cells</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
4650
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="3.-Running-a-SHyFT-simulation">
<h2>3. Running a SHyFT simulation<a class="headerlink" href="#3.-Running-a-SHyFT-simulation" title="Permalink to this headline">¶</a></h2>
<p>Okay, so thus far we have set up our <code class="docutils literal"><span class="pre">cfg</span></code> object which contains most
the information required to run the simulation. We can simply run the
simulation using the <code class="docutils literal"><span class="pre">run</span></code> method.</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
Running simulation...
</pre></div></div>
</div>
<p>But this is may be too simple. Let&#8217;s explore the <code class="docutils literal"><span class="pre">simulator.run</span></code>
method a bit further:</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">help</span><span class="p">(</span><span class="n">simulator</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
Help on method run in module shyft.orchestration.simulator:

run(time_axis=None, state=None) method of shyft.orchestration.simulators.config_simulator.ConfigSimulator instance
    Forward simulation over time axis

    Parameters
    ----------
    time_axis: shyft.api.TimeAxis
        Time axis defining the simulation period, and step sizes.
    state: shyft.api state

</pre></div></div>
</div>
<p>Note that you can pass two parameters to <code class="docutils literal"><span class="pre">run</span></code>. To run a simulation,
we need a time_axis (length of the simulation), and an initial state.
Initially we got both of these from the <code class="docutils literal"><span class="pre">cfg</span></code> object (which takes it
from the .yaml files). However, in some cases you will likely want to
change these and conduct simulations for different periods, or starting
from different states. We explore this further in <a class="reference internal" href="advanced_simulation.html"><span class="doc">Part II: advanced
simulation</span></a></p>
</div>
<div class="section" id="4.-Post-processing-and-data-extraction">
<h2>4. Post processing and data extraction<a class="headerlink" href="#4.-Post-processing-and-data-extraction" title="Permalink to this headline">¶</a></h2>
<p>You have now completed a simple simulation. You probably are interested
to explore some of the output from the simulation and to visulize the
quality of the results. Let&#8217;s explore first, how to access the
underlying data produced from the simulation.</p>
<div class="section" id="Visualizing-the-discharge-for-each-[sub-]catchment">
<h3>Visualizing the discharge for each [sub-]catchment<a class="headerlink" href="#Visualizing-the-discharge-for-each-[sub-]catchment" title="Permalink to this headline">¶</a></h3>
<p>Recall that we earlier referred to the importance of understanding the
<code class="docutils literal"><span class="pre">region_model</span></code>. You&#8217;ll see now that this is where information from the
simulation is actually contained, and that the <code class="docutils literal"><span class="pre">simulator</span></code> object is
more or less a convenience wrapper.</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># Here we are going to extact data from the simulator object.</span>
<span class="c1"># We start by creating a list to hold discharge for each of the subcatchments.</span>
<span class="c1"># Then we&#39;ll get the data from the simulator object</span>

<span class="c1"># mapping of internal catch ID to catchment</span>
<span class="n">catchment_id_map</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">catchment_id_map</span>
<span class="k">print</span><span class="p">(</span><span class="n">catchment_id_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
[1228, 1308, 1330, 1347, 1394, 1443, 1484, 1726, 1765, 1867, 1966, 1996, 2041, 2116, 2129, 2195, 2198, 2277, 2305, 2402, 2446, 2465, 2545, 2640, 2666, 2718, 2728, 2993, 2995, 3002, 3087, 3178, 3536, 3630, 100010, 100011]
</pre></div></div>
</div>
<p>We see here that each sub-catchment in our simulation is associated with
a unique ID. These are user defined IDs. In the case of the nea-nidelva
simulation, they are taken from the GIS database used to create the
example configuration files.</p>
<p>To get data out of the <code class="docutils literal"><span class="pre">region_model</span></code> you need to specify which
catchments you are interested in evaluating. In the following example we
are going to extract the data for each catchment and make a simple plot.</p>
<p>Note that Shyft uses many specialized C++ types. Many of these have
methods to convert to the more familiar <code class="docutils literal"><span class="pre">numpy</span></code> objects. An example
may be the discharge timeseries for a catchment.</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">q_1228_ts</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">discharge</span><span class="p">([</span><span class="mi">1228</span><span class="p">])</span>
<span class="n">q_1228_np</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">discharge</span><span class="p">([</span><span class="mi">1228</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">q_1228_ts</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">q_1228_np</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
&lt;class &#39;shyft.api._api.Timeseries&#39;&gt;
&lt;class &#39;numpy.ndarray&#39;&gt;
</pre></div></div>
</div>
<p><code class="docutils literal"><span class="pre">shyft.api._api.Timeseries</span></code> objects have a lot more functionality, but
we&#8217;ll cover that in a separate tutorial.</p>
<p>For now we&#8217;ll work in a &#8216;pythonic&#8217; and simple way a convert all our data
to python types. To do this, we&#8217;ll use the
<a class="reference external" href="https://www.pandas.org">Pandas</a> library. But note also that we&#8217;ll
have to do some list magic to get the timeseries and datetime values
out.</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># First get the time-axis which we&#39;ll use as the index for the data frame</span>
<span class="n">ta</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">time_axis</span>
<span class="c1"># and convert it to datetimes</span>
<span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ta</span><span class="p">]</span>

<span class="c1"># Now we&#39;ll add all the discharge series for each catchment</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">catchment_id_map</span><span class="p">:</span>
    <span class="c1"># get the discharge time series for the subcatchment</span>
    <span class="n">q_ts</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">discharge</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">)])</span>
    <span class="n">data</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">=</span> <span class="n">q_ts</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
<span class="c1"># we can simply use:</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Catch. ID&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;discharge [m3 s-1]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>Out[12]:
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x7f3d8a999f60&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<img alt="../../_images/notebooks_nea-example_run_nea_nidelva_24_1.png" src="../../_images/notebooks_nea-example_run_nea_nidelva_24_1.png" />
</div>
</div>
<div class="section" id="A-preferred-approach">
<h4>A preferred approach<a class="headerlink" href="#A-preferred-approach" title="Permalink to this headline">¶</a></h4>
<p>As mentioned above, Shyft has it&#8217;s own Timeseries class. This class is
quite powerful, and in <a class="reference external" href="./future_tutorials.rst">future tutorials</a>
we&#8217;ll explore more of the functionality. For now, let&#8217;s look at some key
aspects, and how to create the same plot as above without pandas.</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># api.TsVector() is a list of api.Timeseries type.</span>
<span class="n">discharge_ts</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">TsVector</span><span class="p">()</span> <span class="c1">#  except from the type, it just works as a list()</span>
<span class="c1"># loop over each catchment, and extract the time-series (we keep them as such for now)</span>
<span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">catchment_id_map</span><span class="p">:</span> <span class="c1"># fill in discharge time series for all subcatchments</span>
    <span class="n">discharge_ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">statistics</span><span class="o">.</span><span class="n">discharge</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">cid</span><span class="p">)]))</span>
    <span class="c1"># discharge is a TS object,keeping a .time_axis and .values</span>

</pre></div>
</div>
</div>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># We can make a quick plot of the data of each sub-catchment</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="c1"># plot each catchment discharge in the catchment_id_map</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ts</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">discharge_ts</span><span class="p">):</span>
    <span class="c1"># a ts.time_axis can be enumerated to it&#39;s UtcPeriod,</span>
    <span class="c1"># that will have a .start and .end of type utctimestamp</span>
    <span class="c1"># to use matplotlib support for datetime-axis, we convert it to datetime (as above)</span>
    <span class="n">ts_timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">time_axis</span><span class="p">]</span>
    <span class="n">ts_values</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">values</span> <span class="c1"># iterable and convertible, .to_numpy() makes an np array</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts_timestamps</span><span class="p">,</span><span class="n">ts_values</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">catchment_id_map</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Catch. ID&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;discharge [m3 s-1]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>Out[14]:
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x7f3d8a5d85c0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<img alt="../../_images/notebooks_nea-example_run_nea_nidelva_27_1.png" src="../../_images/notebooks_nea-example_run_nea_nidelva_27_1.png" />
</div>
</div>
</div>
<div class="section" id="A-teaser-to-the-Shyft-API">
<h4>A teaser to the Shyft API<a class="headerlink" href="#A-teaser-to-the-Shyft-API" title="Permalink to this headline">¶</a></h4>
<p>The Shyft API, <code class="docutils literal"><span class="pre">shyft.api</span></code> contains a lot of functionality worth
exploring.</p>
<p>As we mentioned, the <code class="docutils literal"><span class="pre">api.Timeseries</span></code> class provides some tools for
adding timeseries, looking at statistics, etc. Below is a quick
exploration of some of the possibilities. Users should explore using the
source code, tab completion, and most of all <code class="docutils literal"><span class="pre">help</span></code> to get the full
story...</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># First, we can also plot the statistical distribution of the</span>
<span class="c1"># discharges over the sub-catchments</span>

<span class="c1"># get the percentiles we want, note -1 = arithmetic average</span>
<span class="n">percentiles</span><span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">IntVector</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">90</span><span class="p">])</span>

<span class="c1"># create a Daily(for the fun of it!) time-axis for the percentile calculations</span>
<span class="c1"># (our simulation could be hourly)</span>
<span class="n">ta_statistics</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">Timeaxis2</span><span class="p">(</span><span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">time_axis</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">api</span><span class="o">.</span><span class="n">Calendar</span><span class="o">.</span><span class="n">DAY</span><span class="p">,</span><span class="mi">365</span><span class="p">)</span>

<span class="c1"># then simply get out a new set of time-series, corresponding to the percentiles we specified</span>
<span class="c1"># note that discharge_ts is of the api.TsVector type, not a simple list as in our first example above</span>
<span class="n">discharge_percentiles</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">percentiles</span><span class="p">(</span><span class="n">discharge_ts</span><span class="p">,</span><span class="n">ta_statistics</span><span class="p">,</span><span class="n">percentiles</span><span class="p">)</span>

<span class="c1">#utilize that we know that all the percentile time-series share a common time-axis</span>
<span class="n">common_timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ta_statistics</span><span class="p">]</span>

<span class="c1"># Then we can make another plot of the percentile data for the sub-catchments</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="c1"># plot each discharge percentile in the discharge_percentiles</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ts_percentile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">discharge_percentiles</span><span class="p">):</span>
    <span class="n">clr</span><span class="o">=</span><span class="s1">&#39;k&#39;</span>
    <span class="k">if</span> <span class="n">percentiles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">clr</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">percentiles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mf">100.0</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">common_timestamps</span><span class="p">,</span> <span class="n">ts_percentile</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">percentiles</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="n">color</span><span class="o">=</span><span class="n">clr</span><span class="p">)</span>

<span class="c1"># also plot catchment discharge along with the statistics</span>
<span class="c1"># notice that we use .average(ta_statistics) to properly align true-average values to time-axis</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">common_timestamps</span><span class="p">,</span><span class="n">discharge_ts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">ta_statistics</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;CID {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">catchment_id_map</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percentiles&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;discharge [m3 s-1]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>Out[15]:
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x7f3d89d5cd30&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<img alt="../../_images/notebooks_nea-example_run_nea_nidelva_29_1.png" src="../../_images/notebooks_nea-example_run_nea_nidelva_29_1.png" />
</div>
</div>
<p>In <code class="docutils literal"><span class="pre">shyft.orchestration</span></code> there are other functions for exploring the
data. We&#8217;ve created a function that creates the plot above.</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># a simple percentile plot, from orchestration looks nicer</span>
<span class="kn">from</span> <span class="nn">shyft.orchestration</span> <span class="kn">import</span> <span class="n">plotting</span> <span class="k">as</span> <span class="n">splt</span>
<span class="n">oslo</span><span class="o">=</span><span class="n">api</span><span class="o">.</span><span class="n">Calendar</span><span class="p">(</span><span class="s1">&#39;Europe/Oslo&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">splt</span><span class="o">.</span><span class="n">set_calendar_formatter</span><span class="p">(</span><span class="n">oslo</span><span class="p">)</span>
<span class="n">h</span><span class="p">,</span><span class="n">ph</span><span class="o">=</span><span class="n">splt</span><span class="o">.</span><span class="n">plot_np_percentiles</span><span class="p">(</span><span class="n">common_timestamps</span><span class="p">,[</span> <span class="n">p</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">discharge_percentiles</span><span class="p">],</span><span class="n">base_color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<img alt="../../_images/notebooks_nea-example_run_nea_nidelva_31_0.png" src="../../_images/notebooks_nea-example_run_nea_nidelva_31_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Visualizing-the-distributed-catchment-data">
<h3>Visualizing the distributed catchment data<a class="headerlink" href="#Visualizing-the-distributed-catchment-data" title="Permalink to this headline">¶</a></h3>
<p>An important, but difficult concept, to remember when working with
Shyft, is that internally there is no &#8216;grid&#8217; to speak of. The simulation
is vectorized, and each &#8216;cell&#8217; represents a spatial area with it&#8217;s own
area and geolocation information. Therefore, we cannot just load a
datacube of data, as some may be familiar with.</p>
<p>Visualization of this data is a bit more complex, because each
individual cell is in practice an individual polygon. Depending on how
the data has been configured for Shyft (see
<a class="reference external" href="region_model.rst">region_model</a>), the cells may, in fact, be simple
squares or more complex shapes. For the visualization below, we simply
treat them as uniform size, and plot them with the <code class="docutils literal"><span class="pre">scatter</span></code> function
in matplotlib.</p>
<div class="section" id="Extract-data-for-individual-simulation-cells">
<h4>Extract data for individual simulation cells<a class="headerlink" href="#Extract-data-for-individual-simulation-cells" title="Permalink to this headline">¶</a></h4>
<p>We&#8217;ll start by looking at values of individual cells, rather than at the
catchment level. Since Shyft does not have an underlying &#8216;raster&#8217; model,
you need to fetch all cells directly from the underlying
<code class="docutils literal"><span class="pre">region_model</span></code>.</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">cells</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">get_cells</span><span class="p">()</span>

<span class="c1"># Once we have the cells, we can get their coordinate information</span>
<span class="c1"># and fetch the x- and y-location of the cells</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">mid_point</span><span class="p">()</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">mid_point</span><span class="p">()</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>We also will need to get a &#8216;z&#8217; value to make things interesting. Since
this is the first time we&#8217;ve visualized our catchment, let&#8217;s make a map
of the sub-catchments. To do this, the first thing we need to do is get
the membership of each cell. That is, to which catchment does it below.
We do this by extracting the <code class="docutils literal"><span class="pre">catchment_id</span></code> of each cell &#8211; and this
is what we&#8217;ll map. The result will be a map of the sub-catchments.</p>
<p>Recall from above we extracted the <code class="docutils literal"><span class="pre">catchment_id_map</span></code> from the
<code class="docutils literal"><span class="pre">region_model</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># mapping of internal catch ID to catchment</span>
<span class="n">catchment_id_map</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">catchment_id_map</span>
</pre></div>
</div>
<p>We could just use the <code class="docutils literal"><span class="pre">catchment_id</span></code> as the &#8216;z&#8217; value, but since this
could be a string, we&#8217;ll take a different approach. We&#8217;ll assign a
unique integer to each <code class="docutils literal"><span class="pre">catchment_id</span></code> and plot those (it is also
easier for the color bar scaling).</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># let&#39;s create the mapping of catchment_id to an integer:</span>
<span class="n">cid_z_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([</span> <span class="p">(</span><span class="n">catchment_id_map</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">catchment_id_map</span><span class="p">))])</span>

<span class="c1"># then create an array the same length as our &#39;x&#39; and &#39;y&#39;, which holds the</span>
<span class="c1"># integer value that we&#39;ll use for the &#39;z&#39; value</span>
<span class="n">catch_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cid_z_map</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">catchment_id</span><span class="p">()]</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">])</span>

<span class="c1"># and make a quick catchment map...</span>
<span class="c1"># using a scatter plot of the cells</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;rainbow&#39;</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">catch_ids</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;zero-based mapping(proper map tbd)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<img alt="../../_images/notebooks_nea-example_run_nea_nidelva_36_0.png" src="../../_images/notebooks_nea-example_run_nea_nidelva_36_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Visualing-the-Snow-Cover-Area-of-all-cells-for-a-certain-point-in-time">
<h3>Visualing the Snow Cover Area of all cells for a certain point in time<a class="headerlink" href="#Visualing-the-Snow-Cover-Area-of-all-cells-for-a-certain-point-in-time" title="Permalink to this headline">¶</a></h3>
<p>Here we&#8217;ll do some more work to look at a snapshot value of data in each
of the cells. This example is collecting the response variable (here the
Snow Cover Area (SCA)) for each of the cells for a certain point of
time.</p>
<p>The &#8220;response collector&#8221; is another concept within Shyft that is
important keep in mind. We don&#8217;t collect and store responses for every
variable, in order to keep the simulation memory use lean. Therefore,
depending on your application, it may be required to explicitly enable
this. The relevant code is found in <code class="docutils literal"><span class="pre">region_model.h</span></code> in the C++ core
source code.</p>
<p>For the <code class="docutils literal"><span class="pre">ConfigSimulator</span></code> class, which we used to instantiate the
<code class="docutils literal"><span class="pre">simulator</span></code>, a standard collector is used that will provide access to
the most relevant variables.</p>
<p>For a model run during calibration, we are use a collector that just
does the required minimum for the calibration. And, it is still
configurable: we can turn on/off the snow-collection, so if we don&#8217;t
calibrate for snow, they are not collected. More on calibration is shown
in the tutorial: <a class="reference internal" href="calibrate_nea_nidelva.html"><span class="doc">Calibration with
Shyft</span></a></p>
<p>The state collector used for the &#8216;highspeed&#8217; calibration models (C++),
is a null-collector, so no memory allocated, and no cpu-time used.</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1">#first, set a date: year, month, day, (hour of day if hourly time step)</span>
<span class="n">oslo</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">Calendar</span><span class="p">(</span><span class="s1">&#39;Europe/Oslo&#39;</span><span class="p">)</span> <span class="c1"># specifying input calendar in Oslo tz-id</span>
<span class="n">time_x</span> <span class="o">=</span> <span class="n">oslo</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># the oslo calendar(incl dst) converts calendar coordinates Y,M,D.. to its utc-time</span>

<span class="c1"># we need to get the index of the time_axis for the time</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">time_axis</span><span class="o">.</span><span class="n">index_of</span><span class="p">(</span><span class="n">time_x</span><span class="p">)</span> <span class="c1"># index of time x on time-axis</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Date out of range, setting index to 0&quot;</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># fetching SCA (the response variable is named &quot;snow_sca&quot;)</span>
<span class="c1"># You can use tab-completion to explore the `rc`, short for &quot;response collector&quot;</span>
<span class="c1"># object of the cell, to see further response variables available.</span>
<span class="c1"># specifying empty list [] indicates all catchments, otherwise pass catchment_id</span>
<span class="n">sca</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">gamma_snow_response</span><span class="o">.</span><span class="n">sca</span><span class="p">([],</span><span class="n">idx</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let&#8217;s take a closer look at this...</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">time_axis</span><span class="o">.</span><span class="n">index_of</span><span class="p">(</span><span class="n">time_x</span><span class="p">)</span>
</pre></div>
</div>
<p>Simply provided an index value that we can use to index the cells for
the time we&#8217;re interested in looking at.</p>
<p>Next we use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">simulator</span><span class="o">.</span><span class="n">region_model</span><span class="o">.</span><span class="n">gamma_snow_response</span>
</pre></div>
</div>
<p>What is this? This is a collector from the simulation. In this case, for
the <code class="docutils literal"><span class="pre">gamma_snow</span></code> routine. It contains a convenient method to access
the response variables from the simulation on a per catchment level.
Each response variable (<code class="docutils literal"><span class="pre">outflow</span></code>, <code class="docutils literal"><span class="pre">sca</span></code>, <code class="docutils literal"><span class="pre">swe</span></code>) can be called
with two arguments. The first a list of the catchments, and the second
an index to the time, as shown above. Note, this will return the values
for each cell in the sub-catchment. Maybe one is only interested in the
total <code class="docutils literal"><span class="pre">outflow</span></code> or total <code class="docutils literal"><span class="pre">swe</span></code> for the region. In this case you can
use: <code class="docutils literal"><span class="pre">.outflow_value</span></code> which will return a single value.</p>
<p>There is also a response collector for the state variables:
<code class="docutils literal"><span class="pre">.gamma_snow_state</span></code>.</p>
<p>Explore both of these further with tab completion or <code class="docutils literal"><span class="pre">help</span></code>. As well
as the full <code class="docutils literal"><span class="pre">region_model</span></code> to see what other algorithm collectors are
available as this example is configured.</p>
<div class="nbinput nblast container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># for attr in dir(simulator.region_model):</span>
<span class="c1">#     if attr[0] is not &#39;_&#39;: #ignore privates</span>
<span class="c1">#         print(attr)</span>
<span class="c1"># # and don&#39;t forget:</span>
<span class="c1"># help(simulator.region_model.gamma_snow_state)</span>
</pre></div>
</div>
</div>
<p>We are now ready to explore some of the variables from the simulation.
We&#8217;ll continue on with SCA.</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># We can make a simple scatter plot again for quick visualization</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;winter&#39;</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">sca</span><span class="p">,</span>
                  <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                  <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Snow Covered area of {0} on {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">region_model_id</span><span class="p">,</span> <span class="n">oslo</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">time_x</span><span class="p">)))</span>

</pre></div>
</div>
</div>
<div class="nboutput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>Out[21]:
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x7f3d8a7ca080&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<img alt="../../_images/notebooks_nea-example_run_nea_nidelva_42_1.png" src="../../_images/notebooks_nea-example_run_nea_nidelva_42_1.png" />
</div>
</div>
<div class="section" id="A-note-about-the-geometry-of-the-region">
<h4>A note about the geometry of the region<a class="headerlink" href="#A-note-about-the-geometry-of-the-region" title="Permalink to this headline">¶</a></h4>
<p>Again, keep in mind that while we have created a variable that contains
the values for <code class="docutils literal"><span class="pre">sca</span></code> in each cell, this is only an iterable object.
The only reason we know where each value is located is because we have
corresponding <code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code> values for each cell. It is not an array.</p>
<p>We can calculate some statistics directly out of <code class="docutils literal"><span class="pre">sca</span></code>:</p>
<div class="nbinput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="c1"># look at the catchment-wide average:</span>
<span class="n">nea_avg_sca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sca</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Average SCA for Nea Nidelva: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nea_avg_sca</span><span class="p">))</span>

<span class="c1"># And let&#39;s compute histogram of the snow covered area as well</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sca</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;SCA of grid cell&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput container">
<div class="container">
</div>
<div class="container">
<div class="highlight"><pre>
Average SCA for Nea Nidelva: 0.5760404653108396
</pre></div></div>
</div>
<div class="nboutput container">
<div class="highlight-none"><div class="highlight"><pre>
<span></span>Out[22]:
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x7f3d89ad3080&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast container">
<div class="container">
</div>
<div class="container">
<img alt="../../_images/notebooks_nea-example_run_nea_nidelva_44_2.png" src="../../_images/notebooks_nea-example_run_nea_nidelva_44_2.png" />
</div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Running a simulation with SHyFT</a><ul>
<li><a class="reference internal" href="#Introduction">Introduction</a><ul>
<li><a class="reference internal" href="#This-notebook-is-guiding-through-the-simulation-process-of-a-catchment.-The-following-steps-are-described:">This notebook is guiding through the simulation process of a catchment. The following steps are described:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#1.-Loading-required-python-modules-and-setting-path-to-SHyFT-installation">1. Loading required python modules and setting path to SHyFT installation</a><ul>
<li><a class="reference internal" href="#A-note-on-Help-with-Shyft">A note on Help with Shyft</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.-Configuration-of-a-SHyFT-simulation">2. Configuration of a SHyFT simulation</a><ul>
<li><a class="reference internal" href="#The-simulator-and-the-region_model">The simulator and the region_model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#3.-Running-a-SHyFT-simulation">3. Running a SHyFT simulation</a></li>
<li><a class="reference internal" href="#4.-Post-processing-and-data-extraction">4. Post processing and data extraction</a><ul>
<li><a class="reference internal" href="#Visualizing-the-discharge-for-each-[sub-]catchment">Visualizing the discharge for each [sub-]catchment</a><ul>
<li><a class="reference internal" href="#A-preferred-approach">A preferred approach</a></li>
<li><a class="reference internal" href="#A-teaser-to-the-Shyft-API">A teaser to the Shyft API</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Visualizing-the-distributed-catchment-data">Visualizing the distributed catchment data</a><ul>
<li><a class="reference internal" href="#Extract-data-for-individual-simulation-cells">Extract data for individual simulation cells</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Visualing-the-Snow-Cover-Area-of-all-cells-for-a-certain-point-in-time">Visualing the Snow Cover Area of all cells for a certain point in time</a><ul>
<li><a class="reference internal" href="#A-note-about-the-geometry-of-the-region">A note about the geometry of the region</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../../notebook.html"
                        title="previous chapter">Notebooks</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="calibrate_nea_nidelva.html"
                        title="next chapter">Running a calibration with SHyFT</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/notebooks/nea-example/run_nea_nidelva.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="calibrate_nea_nidelva.html" title="Running a calibration with SHyFT"
             >next</a> |</li>
        <li class="right" >
          <a href="../../notebook.html" title="Notebooks"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Shyft 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../getting_started.html" >Getting Started</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../notebook.html" >Notebooks</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Sigbjørn Helset, Ola Skavhaug, John F. Burkhart.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>