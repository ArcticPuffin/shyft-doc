<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.13">
  <compounddef id="kalman_8h" kind="file" language="C++">
    <compoundname>kalman.h</compoundname>
    <includes local="no">string</includes>
    <includes local="no">vector</includes>
    <includes local="no">iterator</includes>
    <includes local="no">algorithm</includes>
    <includes local="no">cmath</includes>
    <includes local="no">stdexcept</includes>
    <includes local="no">armadillo</includes>
    <incdepgraph>
      <node id="1223">
        <label>iterator</label>
      </node>
      <node id="1225">
        <label>cmath</label>
      </node>
      <node id="1226">
        <label>stdexcept</label>
      </node>
      <node id="1221">
        <label>string</label>
      </node>
      <node id="1227">
        <label>armadillo</label>
      </node>
      <node id="1220">
        <label>/Data/johnbur/Dropbox/home/Programming/workspace/shyft_workspace/shyft/core/kalman.h</label>
        <link refid="kalman_8h"/>
        <childnode refid="1221" relation="include">
        </childnode>
        <childnode refid="1222" relation="include">
        </childnode>
        <childnode refid="1223" relation="include">
        </childnode>
        <childnode refid="1224" relation="include">
        </childnode>
        <childnode refid="1225" relation="include">
        </childnode>
        <childnode refid="1226" relation="include">
        </childnode>
        <childnode refid="1227" relation="include">
        </childnode>
      </node>
      <node id="1222">
        <label>vector</label>
      </node>
      <node id="1224">
        <label>algorithm</label>
      </node>
    </incdepgraph>
    <innerclass refid="structshyft_1_1core_1_1kalman_1_1state" prot="public">shyft::core::kalman::state</innerclass>
    <innerclass refid="structshyft_1_1core_1_1kalman_1_1parameter" prot="public">shyft::core::kalman::parameter</innerclass>
    <innerclass refid="structshyft_1_1core_1_1kalman_1_1filter" prot="public">shyft::core::kalman::filter</innerclass>
    <innerclass refid="structshyft_1_1core_1_1kalman_1_1bias__predictor" prot="public">shyft::core::kalman::bias_predictor</innerclass>
    <innernamespace refid="namespaceshyft">shyft</innernamespace>
    <innernamespace refid="namespaceshyft_1_1core">shyft::core</innernamespace>
    <innernamespace refid="namespaceshyft_1_1core_1_1kalman">shyft::core::kalman</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="preprocessor">#pragma<sp/>once</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;vector&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;iterator&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;algorithm&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cmath&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdexcept&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;armadillo&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal"><ref refid="namespaceshyft" kindref="compound">shyft</ref><sp/>{</highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal">core<sp/>{</highlight></codeline>
<codeline lineno="14" refid="namespaceshyft_1_1core_1_1kalman" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal">kalman<sp/>{</highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">using<sp/>namespace<sp/></highlight><highlight class="normal"><ref refid="namespacestd" kindref="compound">std</ref>;</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">using<sp/>namespace<sp/></highlight><highlight class="normal"><ref refid="namespaceshyft_1_1core" kindref="compound">shyft::core</ref>;</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="22" refid="structshyft_1_1core_1_1kalman_1_1state" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structshyft_1_1core_1_1kalman_1_1state" kindref="compound">state</ref><sp/>{</highlight></codeline>
<codeline lineno="23" refid="structshyft_1_1core_1_1kalman_1_1state_1a2a05a2b248bc845163cd9829a0277adf" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>arma::vec<sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state_1a2a05a2b248bc845163cd9829a0277adf" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="24" refid="structshyft_1_1core_1_1kalman_1_1state_1ada5f9683db70a257a7724d69832dc8d5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>arma::vec<sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state_1ada5f9683db70a257a7724d69832dc8d5" kindref="member">k</ref>;</highlight></codeline>
<codeline lineno="25" refid="structshyft_1_1core_1_1kalman_1_1state_1ab374afb978809b08d3326ab4337cb330" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>arma::mat<sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state_1ab374afb978809b08d3326ab4337cb330" kindref="member">P</ref>;</highlight></codeline>
<codeline lineno="26" refid="structshyft_1_1core_1_1kalman_1_1state_1ae1cf11da352d46341d7aec238977de55" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>arma::mat<sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state_1ae1cf11da352d46341d7aec238977de55" kindref="member">W</ref>;</highlight></codeline>
<codeline lineno="27" refid="structshyft_1_1core_1_1kalman_1_1state_1a67e5ec1bf5a9b28e4e6cc9665d3e8858" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state_1a67e5ec1bf5a9b28e4e6cc9665d3e8858" kindref="member">size</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)x.n_elem;}</highlight></codeline>
<codeline lineno="28" refid="structshyft_1_1core_1_1kalman_1_1state_1acee1babda8dd7c30ae9c5389e8d412a6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state_1acee1babda8dd7c30ae9c5389e8d412a6" kindref="member">state</ref>(){}</highlight></codeline>
<codeline lineno="29" refid="structshyft_1_1core_1_1kalman_1_1state_1a178db6a177d0741197decfa4220fd8be" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state_1a178db6a177d0741197decfa4220fd8be" kindref="member">state</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_daily_observations,</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>covariance_init,</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>hourly_correlation,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>process_noise_init)<sp/>{</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x<sp/>=<sp/>arma::vec(n_daily_observations);x.fill(0.0);</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>k<sp/>=<sp/>arma::vec(n_daily_observations);k.fill(0.0);</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>P<sp/>=<sp/>make_covariance(n_daily_observations,<sp/><sp/>covariance_init,hourly_correlation);</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>W<sp/>=<sp/>make_covariance(n_daily_observations,process_noise_init*process_noise_init,hourly_correlation);</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="35" refid="structshyft_1_1core_1_1kalman_1_1state_1a048229143072f559276adedfd2a79dfb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/>arma::mat<sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state_1a048229143072f559276adedfd2a79dfb" kindref="member">make_covariance</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_daily_observations,</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>covariance_init,</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>hourly_correlation)<sp/>{</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>arma::mat<sp/>P(n_daily_observations,n_daily_observations);</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>dt_hours=24.0/n_daily_observations;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i=0;i&lt;n_daily_observations;++i)<sp/>{</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j=0;j&lt;n_daily_observations;++j)<sp/>{</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>correlation<sp/>is<sp/>proportional<sp/>to<sp/>the<sp/>daily-folded<sp/>distance<sp/>between<sp/>i<sp/>and<sp/>j</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>so<sp/>the<sp/>last<sp/>time-step<sp/>in<sp/>a<sp/>day<sp/>is<sp/>closest<sp/>to<sp/>the<sp/>first<sp/>hour<sp/>of<sp/>the<sp/>next<sp/>day<sp/>etc.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>is<sp/>essential<sp/>to<sp/>the<sp/>time-folding<sp/>and<sp/>&apos;solar&apos;<sp/>driven<sp/>pattern<sp/>of<sp/>bias.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ix_diff=<sp/><ref refid="namespaceshyft_1_1time__series_1adba838103548ab86fd91e469830eca9f" kindref="member">std::min</ref>(abs(i-j),n_daily_observations-abs(i-j));</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>P.at(i,j)<sp/>=<sp/>covariance_init*pow(hourly_correlation,ix_diff*dt_hours);</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>P;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="54" refid="structshyft_1_1core_1_1kalman_1_1parameter" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structshyft_1_1core_1_1kalman_1_1parameter" kindref="compound">parameter</ref><sp/>{</highlight></codeline>
<codeline lineno="55" refid="structshyft_1_1core_1_1kalman_1_1parameter_1a6eb5fd7e0113abe24f72c7d4abc3031b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_daily_observations=8;</highlight></codeline>
<codeline lineno="56" refid="structshyft_1_1core_1_1kalman_1_1parameter_1a8ba7b7fa8216910243f01dd5f51519a2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>hourly_correlation=0.93;</highlight></codeline>
<codeline lineno="57" refid="structshyft_1_1core_1_1kalman_1_1parameter_1a15eff8a125cbe4e3044fab14869a5d0e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>covariance_init=0.5;</highlight></codeline>
<codeline lineno="58" refid="structshyft_1_1core_1_1kalman_1_1parameter_1a1fa357db699ee0a14954d798eb034d6b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>std_error_bias_measurements=2.0;</highlight></codeline>
<codeline lineno="59" refid="structshyft_1_1core_1_1kalman_1_1parameter_1a1a811cc5f0e0af0ccceaae85ba485af4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>ratio_std_w_over_v=0.06;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="70" refid="structshyft_1_1core_1_1kalman_1_1parameter_1a104e73a773325740c84eebafc0ffa876" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1parameter_1a104e73a773325740c84eebafc0ffa876" kindref="member">parameter</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n_daily_observations=8,</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>hourly_correlation=0.93,</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>covariance_init=0.5,</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>std_error_bias_measurements=2.0,</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>ratio_std_w_over_v=0.15</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>):</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n_daily_observations(n_daily_observations),</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hourly_correlation(hourly_correlation),</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>covariance_init(covariance_init),</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std_error_bias_measurements(std_error_bias_measurements),</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ratio_std_w_over_v(ratio_std_w_over_v)<sp/>{}</highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="101" refid="structshyft_1_1core_1_1kalman_1_1filter" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structshyft_1_1core_1_1kalman_1_1filter" kindref="compound">filter</ref><sp/>{</highlight></codeline>
<codeline lineno="102" refid="structshyft_1_1core_1_1kalman_1_1filter_1a9123c603c6d63f6e0de39e2248bce5cc" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1parameter" kindref="compound">parameter</ref><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1filter_1a9123c603c6d63f6e0de39e2248bce5cc" kindref="member">p</ref>;</highlight></codeline>
<codeline lineno="103" refid="structshyft_1_1core_1_1kalman_1_1filter_1a5348b7b92165d26295ad939dfbe0dc5e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1filter_1a5348b7b92165d26295ad939dfbe0dc5e" kindref="member">filter</ref>(){}</highlight></codeline>
<codeline lineno="104" refid="structshyft_1_1core_1_1kalman_1_1filter_1a67dd8b5e4198fb9d492e36c8923e049e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1filter_1a67dd8b5e4198fb9d492e36c8923e049e" kindref="member">filter</ref>(<ref refid="structshyft_1_1core_1_1kalman_1_1parameter" kindref="compound">parameter</ref><sp/>p):p(p){}</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="107" refid="structshyft_1_1core_1_1kalman_1_1filter_1a75746092f2b077ed8e3120953782bb3c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state" kindref="compound">state</ref><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1filter_1a75746092f2b077ed8e3120953782bb3c" kindref="member">create_initial_state</ref>()</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state" kindref="compound">state</ref>(p.<ref refid="structshyft_1_1core_1_1kalman_1_1parameter_1a6eb5fd7e0113abe24f72c7d4abc3031b" kindref="member">n_daily_observations</ref>,p.<ref refid="structshyft_1_1core_1_1kalman_1_1parameter_1a15eff8a125cbe4e3044fab14869a5d0e" kindref="member">covariance_init</ref>,p.<ref refid="structshyft_1_1core_1_1kalman_1_1parameter_1a8ba7b7fa8216910243f01dd5f51519a2" kindref="member">hourly_correlation</ref>,p.<ref refid="structshyft_1_1core_1_1kalman_1_1parameter_1a1fa357db699ee0a14954d798eb034d6b" kindref="member">std_error_bias_measurements</ref>!=0.0?p.<ref refid="structshyft_1_1core_1_1kalman_1_1parameter_1a1a811cc5f0e0af0ccceaae85ba485af4" kindref="member">ratio_std_w_over_v</ref>*p.<ref refid="structshyft_1_1core_1_1kalman_1_1parameter_1a1fa357db699ee0a14954d798eb034d6b" kindref="member">std_error_bias_measurements</ref>:100.0);</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="112" refid="structshyft_1_1core_1_1kalman_1_1filter_1a8446e1feb0f239bdaa14b7bc36f926d5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1filter_1a8446e1feb0f239bdaa14b7bc36f926d5" kindref="member">fold_to_daily_observation</ref>(<ref refid="namespaceshyft_1_1core_1abbf72b8ba32c19e92f5263070c1e9d13" kindref="member">utctime</ref><sp/>t)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>((t/<ref refid="namespaceshyft_1_1core_1a7ef37ab10073a3d0e9cf509d93d114b2" kindref="member">deltahours</ref>(1)<sp/>+<sp/>200L*24*365)<sp/>%<sp/>24)*p.<ref refid="structshyft_1_1core_1_1kalman_1_1parameter_1a6eb5fd7e0113abe24f72c7d4abc3031b" kindref="member">n_daily_observations</ref>/24;</highlight><highlight class="comment">//<sp/>in<sp/>short,<sp/>add<sp/>200<sp/>years<sp/>(ensure<sp/>positve<sp/>num<sp/>before<sp/>%)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="125" refid="structshyft_1_1core_1_1kalman_1_1filter_1a270aa43e7632183ffa9a3b8c98e541ec" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1filter_1a270aa43e7632183ffa9a3b8c98e541ec" kindref="member">update</ref>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>observed_bias,<ref refid="namespaceshyft_1_1core_1abbf72b8ba32c19e92f5263070c1e9d13" kindref="member">utctime</ref><sp/>t,<ref refid="structshyft_1_1core_1_1kalman_1_1state" kindref="compound">state</ref>&amp;<sp/>s)</highlight><highlight class="keyword"><sp/>const<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1ab374afb978809b08d3326ab4337cb330" kindref="member">P</ref>=<sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1ab374afb978809b08d3326ab4337cb330" kindref="member">P</ref><sp/>+<sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1ae1cf11da352d46341d7aec238977de55" kindref="member">W</ref>;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(isfinite(observed_bias))<sp/>{</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ix=<sp/>fold_to_daily_observation(t);</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>tmp<sp/>=<sp/>(s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1ab374afb978809b08d3326ab4337cb330" kindref="member">P</ref>.at(ix,<sp/>ix)<sp/>+<sp/>p.<ref refid="structshyft_1_1core_1_1kalman_1_1parameter_1a1fa357db699ee0a14954d798eb034d6b" kindref="member">std_error_bias_measurements</ref>*p.<ref refid="structshyft_1_1core_1_1kalman_1_1parameter_1a1fa357db699ee0a14954d798eb034d6b" kindref="member">std_error_bias_measurements</ref>);</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1ada5f9683db70a257a7724d69832dc8d5" kindref="member">k</ref><sp/>=<sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1ab374afb978809b08d3326ab4337cb330" kindref="member">P</ref>.col(ix)<sp/>/<sp/>tmp;</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>wants<sp/>this:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1ab374afb978809b08d3326ab4337cb330" kindref="member">P</ref><sp/>=<sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1ab374afb978809b08d3326ab4337cb330" kindref="member">P</ref><sp/>-<sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1ab374afb978809b08d3326ab4337cb330" kindref="member">P</ref>.col(ix)*s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1ab374afb978809b08d3326ab4337cb330" kindref="member">P</ref>.row(ix)/tmp;</highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>old<sp/>s.P=<sp/>1.0<sp/>-<sp/>s.k[ix]*s.P;</highlight></codeline>
<codeline lineno="138"><highlight class="comment"></highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1a2a05a2b248bc845163cd9829a0277adf" kindref="member">x</ref><sp/>=<sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1a2a05a2b248bc845163cd9829a0277adf" kindref="member">x</ref><sp/>+<sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1ada5f9683db70a257a7724d69832dc8d5" kindref="member">k</ref>*(observed_bias<sp/>-<sp/>s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1a2a05a2b248bc845163cd9829a0277adf" kindref="member">x</ref>[ix]);</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="152" refid="structshyft_1_1core_1_1kalman_1_1bias__predictor" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structshyft_1_1core_1_1kalman_1_1bias__predictor" kindref="compound">bias_predictor</ref><sp/>{</highlight></codeline>
<codeline lineno="153" refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1a7ff341b40a1146cd5d20e3f45b2a7aeb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1filter" kindref="compound">filter</ref><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1a7ff341b40a1146cd5d20e3f45b2a7aeb" kindref="member">f</ref>;</highlight></codeline>
<codeline lineno="154" refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1a03f54ceda671d8e264e00e37616cf766" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state" kindref="compound">state</ref><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1a03f54ceda671d8e264e00e37616cf766" kindref="member">s</ref>;<sp/></highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156" refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1a686bc8a372437bd5aace85dc4d65d8a2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1a686bc8a372437bd5aace85dc4d65d8a2" kindref="member">bias_predictor</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="157" refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1a5fc9cae5d9cb6db72fa727a9fe9de2e4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1a5fc9cae5d9cb6db72fa727a9fe9de2e4" kindref="member">bias_predictor</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1filter" kindref="compound">filter</ref>&amp;<sp/>f):f(f),s(f.create_initial_state())<sp/>{}</highlight></codeline>
<codeline lineno="158" refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1abf3e2d6ca8ad2e06d51393dbf2a7c4f5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1abf3e2d6ca8ad2e06d51393dbf2a7c4f5" kindref="member">bias_predictor</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1filter" kindref="compound">filter</ref>&amp;<sp/>f,</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1state" kindref="compound">state</ref>&amp;<sp/>s):f(f),s(s){}</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">class</highlight><highlight class="normal"><sp/>fc_ts,</highlight><highlight class="keyword">class</highlight><highlight class="normal"><sp/>obs_ts,</highlight><highlight class="keyword">class</highlight><highlight class="normal"><sp/>ta&gt;</highlight></codeline>
<codeline lineno="171" refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1a2964e0d74b45e32273878329a79b324f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1a2964e0d74b45e32273878329a79b324f" kindref="member">update_with_forecast</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::vector&lt;fc_ts&gt;&amp;<sp/>fc_ts_set,</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>obs_ts&amp;<sp/>observation_ts,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="namespaceshyft_1_1time__axis" kindref="compound">ta</ref>&amp;<sp/>time_axis)<sp/>{</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classshyft_1_1time__series_1_1average__accessor" kindref="compound">shyft::time_series::average_accessor&lt;obs_ts,ta&gt;</ref><sp/>obs(observation_ts,time_axis);</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>fcts:fc_ts_set)<sp/>{</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classshyft_1_1time__series_1_1average__accessor" kindref="compound">shyft::time_series::average_accessor&lt;fc_ts,ta&gt;</ref><sp/>fc(fcts,time_axis);</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i=0;i&lt;time_axis.size();++i)<sp/>{</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!fcts.total_period().contains(time_axis.time(i)))</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight><highlight class="comment">//<sp/>skip<sp/>when<sp/>fc<sp/>is<sp/>not<sp/>valid/available</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>bias<sp/>=<sp/>fc.<ref refid="classshyft_1_1time__series_1_1average__accessor_1ada2969812936368e6bc2f96567d972e6" kindref="member">value</ref>(i)<sp/>-<sp/>obs.<ref refid="classshyft_1_1time__series_1_1average__accessor_1ada2969812936368e6bc2f96567d972e6" kindref="member">value</ref>(i);</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(isfinite(bias))<sp/></highlight><highlight class="comment">//<sp/>we<sp/>skip<sp/>nan&apos;s<sp/>here,<sp/>just<sp/>want<sp/>to<sp/>&apos;learn&apos;<sp/>from<sp/>non-nan-<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f.<ref refid="structshyft_1_1core_1_1kalman_1_1filter_1a270aa43e7632183ffa9a3b8c98e541ec" kindref="member">update</ref>(bias,time_axis.time(i),s);</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">&lt;</highlight><highlight class="keyword">class</highlight><highlight class="normal"><sp/>a_ts,<sp/></highlight><highlight class="keyword">class</highlight><highlight class="normal"><sp/>fc_ts,</highlight><highlight class="keyword">class</highlight><highlight class="normal"><sp/>obs_ts,</highlight><highlight class="keyword">class</highlight><highlight class="normal"><sp/>ta&gt;</highlight></codeline>
<codeline lineno="201" refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1ad7195cbd7be2399639714a1a7a4ea0ab" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a_ts<sp/><ref refid="structshyft_1_1core_1_1kalman_1_1bias__predictor_1ad7195cbd7be2399639714a1a7a4ea0ab" kindref="member">compute_running_bias</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>fc_ts&amp;<sp/>fcts,</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>obs_ts&amp;<sp/>observation_ts,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="namespaceshyft_1_1time__axis" kindref="compound">ta</ref>&amp;<sp/>time_axis)<sp/>{</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classshyft_1_1time__series_1_1average__accessor" kindref="compound">shyft::time_series::average_accessor&lt;obs_ts,ta&gt;</ref><sp/>obs(observation_ts,time_axis);</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classshyft_1_1time__series_1_1average__accessor" kindref="compound">shyft::time_series::average_accessor&lt;fc_ts,ta&gt;</ref><sp/>fc(fcts,time_axis);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;double&gt;<sp/>bias_vector;bias_vector.reserve(time_axis.size());</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1core_1_1calendar" kindref="compound">shyft::core::calendar</ref><sp/>utc;</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceshyft_1_1core_1abbf72b8ba32c19e92f5263070c1e9d13" kindref="member">utctime</ref><sp/>pd_t0<sp/>=<sp/>utc.<ref refid="structshyft_1_1core_1_1calendar_1a207bd4e9e692ad81a8880b114912174a" kindref="member">trim</ref>(time_axis.time(0),<ref refid="structshyft_1_1core_1_1calendar_1a1845092dc0ca5336cc32ead6c98820c7" kindref="member">shyft::core::calendar::DAY</ref>);</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceshyft_1_1core_1abbf72b8ba32c19e92f5263070c1e9d13" kindref="member">utctime</ref><sp/>pd_dt<sp/>=<sp/><ref refid="namespaceshyft_1_1core_1a7ef37ab10073a3d0e9cf509d93d114b2" kindref="member">shyft::core::deltahours</ref>(24)/f.<ref refid="structshyft_1_1core_1_1kalman_1_1filter_1a9123c603c6d63f6e0de39e2248bce5cc" kindref="member">p</ref>.<ref refid="structshyft_1_1core_1_1kalman_1_1parameter_1a6eb5fd7e0113abe24f72c7d4abc3031b" kindref="member">n_daily_observations</ref>;</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1time__series_1_1profile__description" kindref="compound">shyft::time_series::profile_description</ref><sp/>pd(pd_t0,pd_dt,arma::conv_to&lt;std::vector&lt;double&gt;&gt;::from(s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1a2a05a2b248bc845163cd9829a0277adf" kindref="member">x</ref>));</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structshyft_1_1time__series_1_1profile__accessor" kindref="compound">shyft::time_series::profile_accessor&lt;ta&gt;</ref><sp/>pa(pd,time_axis,<ref refid="namespaceshyft_1_1time__series_1ab66642bfe2651c86498cf53c9217710fa6b1c6c9e56366f103913f2fc503270c3" kindref="member">POINT_AVERAGE_VALUE</ref>);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i_save_point=0;<sp/></highlight><highlight class="comment">//<sp/>keep<sp/>track<sp/>of<sp/>when<sp/>we<sp/>extract<sp/>day-bias</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i_save_point_delta<sp/>=<sp/><ref refid="namespaceshyft_1_1core_1a7ef37ab10073a3d0e9cf509d93d114b2" kindref="member">shyft::core::deltahours</ref>(24)/time_axis.dt;<sp/></highlight><highlight class="comment">//<sp/>ta</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i=0;i&lt;time_axis.size();++i)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(i==i_save_point)<sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>j=0;j&lt;pa.<ref refid="structshyft_1_1time__series_1_1profile__accessor_1a1a3dba4abc45923b5e48ad4222e2bafb" kindref="member">profile</ref>.profile.size();++j)</highlight><highlight class="comment">//<sp/>update<sp/>profle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pa.<ref refid="structshyft_1_1time__series_1_1profile__accessor_1a1a3dba4abc45923b5e48ad4222e2bafb" kindref="member">profile</ref>.profile[j]=s.<ref refid="structshyft_1_1core_1_1kalman_1_1state_1a2a05a2b248bc845163cd9829a0277adf" kindref="member">x</ref>.at(j);</highlight><highlight class="comment">//=arma::conv_to&lt;std::vector&lt;double&gt;&gt;::from(s.x);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>i_next_save_point<sp/>=<sp/>i_save_point<sp/>+<sp/>i_save_point_delta;</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(i_next_save_point&gt;time_axis.size())<sp/></highlight><highlight class="comment">//<sp/>figure<sp/>out<sp/>how<sp/>many<sp/>value<sp/>to<sp/>fill<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i_next_save_point<sp/>=<sp/>time_axis.size();</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>k=i_save_point;k&lt;i_next_save_point;++k)</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bias_vector.push_back(pa.<ref refid="structshyft_1_1time__series_1_1profile__accessor_1a703cf6bc3692c8fc22b5192b977eef3b" kindref="member">value</ref>(k));</highlight><highlight class="comment">//<sp/>push<sp/>out<sp/>result</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i_save_point<sp/>=<sp/>i_next_save_point;</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(fcts.total_period().contains(time_axis.time(i)))<sp/>{</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>bias<sp/>=<sp/>fc.<ref refid="classshyft_1_1time__series_1_1average__accessor_1ada2969812936368e6bc2f96567d972e6" kindref="member">value</ref>(i)<sp/>-<sp/>obs.<ref refid="classshyft_1_1time__series_1_1average__accessor_1ada2969812936368e6bc2f96567d972e6" kindref="member">value</ref>(i);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(isfinite(bias))<sp/></highlight><highlight class="comment">//<sp/>we<sp/>skip<sp/>nan&apos;s<sp/>here,<sp/>just<sp/>want<sp/>to<sp/>&apos;learn&apos;<sp/>from<sp/>non-nan-<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f.<ref refid="structshyft_1_1core_1_1kalman_1_1filter_1a270aa43e7632183ffa9a3b8c98e541ec" kindref="member">update</ref>(bias,time_axis.time(i),s);</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="231"><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>a_ts(time_axis,bias_vector,<ref refid="namespaceshyft_1_1time__series_1ab66642bfe2651c86498cf53c9217710fa6b1c6c9e56366f103913f2fc503270c3" kindref="member">POINT_AVERAGE_VALUE</ref>);</highlight></codeline>
<codeline lineno="233"><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="239"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="/Data/johnbur/Dropbox/home/Programming/workspace/shyft_workspace/shyft/core/kalman.h"/>
  </compounddef>
</doxygen>
